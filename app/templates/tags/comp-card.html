{% load websocket_tags %}

<div 
    id="comp-info-card"
    class="col-lg-3 col-12 text-center mb-2"
    style="height:fit-content"
>
    <div class="card shadow">
        <div class="card-header">
            <h2>{{ competition.theme }}</h2>
            <small class="card-title">Hosted by {{ competition.owner }}</small>
        </div>
        <div class="card-title">
            <div class="row mx-1 my-3">
                <div class="input-group" style="z-index:0">
                    <input id="room-url"
                            type="text"
                            class="form-control"
                            value="ID: {{ competition.name }}"
                            disabled>
                    <button class="btn btn-primary" onclick="copyLink()">Copy</button>
                </div>
            </div>
            <div class="row">
                <p id="num_memes">
                    {{ competition.num_memes }} meme{{ competition.num_memes|pluralize }} submitted by {{ competition.num_uploaders }} {{ competition.num_uploaders|pluralize:'person,people' }}
                </p>
            </div>
        </div>
        <div class="card-body">
            <div class="row mx-1">
                <button class="btn btn-light btn-sm d-flex justify-content-center"
                        type="button"
                        onclick="toggleShowParticipants()">
                    Participants &nbsp;<span id="num-participants">({{ competition.num_participants }})</span>
                </button>
                <div class="overflow-auto participants-box p-1" style="max-height: 200px;">
                    <ul id="participants" class="list-group">
                        {% for participant in competition.sorted_participants %}
                            {% participant_li participant.id %}
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="row text-center">
                {% if user == competition.owner %}
                    <div class="d-flex justify-content-between mt-3">
                        <button id="start-comp-btn"
                                class="btn btn-success"
                                style="width:100%"
                                onclick="startCompetition('{{competition.name}}')"
                                {% if competition.started %}disabled{% endif %}>
                            {% if competition.started %}
                                Competition started
                            {% else %}
                                Start Competition
                            {% endif %}
                        </button>
                        <button id="cancel-comp-btn"
                                class="btn btn-danger"
                                onclick="cancelCompetition('{{competition.name}}')"
                                {% if not competition.started %}disabled{% endif %}>
                            <i class="bi bi-x-square"></i>
                        </button>
                    </div>
                    <p>
                        <button id="next-meme-btn"
                                class="btn btn-primary mx-auto mt-3 col-6"
                                onclick="advanceCompetition('{{competition.name}}')"
                                {% if not competition.started or competition.finished %}style="display:none"{% endif %}>
                            Next meme
                        </button>
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    function toggleShowParticipants() {
		const box = $('.participants-box');
		if(box.hasClass('collapse')) {
			box.removeClass('collapse')
		} else {
			box.addClass('collapse')
		}
	}
	
	function copyLink() {
		// Get the text field
		var compLink = window.location.host + "{% url 'competition' competition.name %}";
		navigator.clipboard.writeText(compLink)
		console.log('copied', compLink)

		// Copy the text inside the text field
		// Alert the copied text
		showSnackbar("Competition URL has been copied", 'primary');
	}

	

</script>